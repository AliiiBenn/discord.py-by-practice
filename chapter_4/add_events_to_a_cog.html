<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>add events to a cog - Discord.py Exercices</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../chapter_1/events.html"><strong aria-hidden="true">2.</strong> Chapter 1 - Events</a></li><li class="chapter-item expanded "><a href="../chapter_2/commands.html"><strong aria-hidden="true">3.</strong> Chapter 2 - Commands</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_2/without_arguments.html"><strong aria-hidden="true">3.1.</strong> without arguments</a></li><li class="chapter-item expanded "><a href="../chapter_2/unique_argument.html"><strong aria-hidden="true">3.2.</strong> unique argument</a></li><li class="chapter-item expanded "><a href="../chapter_2/multiple_arguments.html"><strong aria-hidden="true">3.3.</strong> multiple arguments</a></li><li class="chapter-item expanded "><a href="../chapter_2/string_arguments.html"><strong aria-hidden="true">3.4.</strong> string arguments</a></li><li class="chapter-item expanded "><a href="../chapter_2/commands_errors.html"><strong aria-hidden="true">3.5.</strong> commands errors</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_3/basic_converters.html"><strong aria-hidden="true">4.</strong> Chapter 3 - Bacic Converters</a></li><li class="chapter-item expanded "><a href="../chapter_4/cogs.html"><strong aria-hidden="true">5.</strong> Chapter 4 - Cogs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_4/add_commands_to_a_cog.html"><strong aria-hidden="true">5.1.</strong> add commands to a cog</a></li><li class="chapter-item expanded "><a href="../chapter_4/add_events_to_a_cog.html" class="active"><strong aria-hidden="true">5.2.</strong> add events to a cog</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_5/embeds.html"><strong aria-hidden="true">6.</strong> Chapter 5 - Embeds</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_5/create_an_embed.html"><strong aria-hidden="true">6.1.</strong> create an embed</a></li><li class="chapter-item expanded "><a href="../chapter_5/customize_an_embed.html"><strong aria-hidden="true">6.2.</strong> customize an embed</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_6/slash_commands.html"><strong aria-hidden="true">7.</strong> Chapter 6 - Slash Commands</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_6/create_a_slash_command.html"><strong aria-hidden="true">7.1.</strong> create a slash command</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_7/hybrid_commands.html"><strong aria-hidden="true">8.</strong> Chapter 7 - Hybrid Commands</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_7/create_a_hybrid_command.html"><strong aria-hidden="true">8.1.</strong> create a hybrid command</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_8/converters.html"><strong aria-hidden="true">9.</strong> Chapter 8 - Converters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter_8/functions_converters.html"><strong aria-hidden="true">9.1.</strong> functions converters</a></li><li class="chapter-item expanded "><a href="../chapter_8/advanced_converters.html"><strong aria-hidden="true">9.2.</strong> advanced converters</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Discord.py Exercices</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="add-events-to-a-cog"><a class="header" href="#add-events-to-a-cog">add events to a cog</a></h1>
<p>Les évènements dans les Cogs sont définis à l'aide du décorateur <code>commands.Cog.listener</code>. Ce décorateur prend en paramètre optionnel le nom de l'évènement. Si le nom de l'évènement n'est pas spécifié, le nom de la méthode sera utilisé comme nom de l'évènement. Par exemple, la méthode <code>on_message</code> sera appelée lorsqu'un message est envoyé dans un salon.</p>
<pre><code class="language-python">import discord
from discord.ext import commands

class PingCog(commands.Cog):
    def __init__(self, bot : commands.Bot):
        self.bot = bot

    @commands.Cog.listener()
    async def on_message(self, message : discord.Message) -&gt; None:
        if message.content == &quot;ping&quot;:
            await message.channel.send(&quot;pong&quot;)

</code></pre>
<p>On voit que la méthode <code>on_message</code> prend en paramètre le message envoyé et qu'elle est considérée comme un Cog car elle a le décorateur <code>commands.Cog.listener</code>. On peut voir que le nom de l'évènement est <code>on_message</code> car le nom de la méthode est <code>on_message</code>.</p>
<p>On peut aussi définir un évènement sans le nom de la méthode. Dans ce cas, le nom de l'évènement sera le nom de la méthode sans le préfixe <code>on_</code>. Par exemple, la méthode <code>message</code> sera appelée lorsqu'un message est envoyé dans un salon.</p>
<pre><code class="language-python">import discord
from discord.ext import commands

class PingCog(commands.Cog):
    def __init__(self, bot : commands.Bot):
        self.bot = bot

    @commands.Cog.listener(&quot;on_message&quot;)
    async def message(self, message : discord.Message) -&gt; None:
        if message.content == &quot;ping&quot;:
            await message.channel.send(&quot;pong&quot;)

</code></pre>
<p>On voit que la méthode <code>message</code> prend en paramètre le message envoyé et qu'elle est considérée comme un Cog car elle a le décorateur <code>commands.Cog.listener</code>. On peut voir que le nom de l'évènement est <code>on_message</code> car le nom de la méthode est <code>message</code>.</p>
<hr />
<h1 id="exercices"><a class="header" href="#exercices">Exercices</a></h1>
<h3 id="exercice-1"><a class="header" href="#exercice-1">Exercice 1</a></h3>
<p>Créer un Cog <code>CountCog</code> qui contient dans son constructeur un attribut <code>count</code> qui est initialisé à 0. Ce Cog doit avoir un évènement <code>on_message</code> qui incrémente l'attribut <code>count</code> à chaque fois qu'un message est envoyé dans un salon. Le Cog doit aussi avoir une commande <code>count</code> qui affiche la valeur de l'attribut <code>count</code>.</p>
<p>L'évènement et la commande auront donc la structure suivante :</p>
<pre><code class="language-python">@commands.Cog.listener()
async def on_message(self, message : discord.Message) -&gt; None:
    ...
</code></pre>
<pre><code class="language-python">@commands.command()
async def count(self, ctx : commands.Context) -&gt; discord.Message:
    ...
</code></pre>
<details>
<summary>Solution</summary>
<pre><code class="language-python">import discord
from discord.ext import commands

class CountCog(commands.Cog):
    def __init__(self, bot : commands.Bot):
        self.bot = bot
        self.count = 0

    @commands.Cog.listener()
    async def on_message(self, message : discord.Message) -&gt; None:
        self.count += 1

    @commands.command()
    async def count(self, ctx : commands.Context) -&gt; discord.Message:
        return await ctx.send(f&quot;count: {self.count}&quot;)

</code></pre>
</details>
<h3 id="exercice-2"><a class="header" href="#exercice-2">Exercice 2</a></h3>
<p>Créer un Cog <code>Welcome</code> qui contient dans son constructeur un attribut <code>welcome_channel</code> qui est initialisé à <code>None</code>. Ce Cog doit avoir un évènement <code>on_member_join</code> qui envoie un message de bienvenue dans le salon <code>welcome_channel</code> si celui-ci est défini. Le Cog doit aussi avoir une commande <code>set_welcome_channel</code> qui permet de définir le salon de bienvenue.</p>
<p>L'évènement et la commande auront donc la structure suivante :</p>
<pre><code class="language-python">@commands.Cog.listener()
async def on_member_join(self, member : discord.Member) -&gt; None:
    ...
</code></pre>
<pre><code class="language-python">@commands.command()
async def set_welcome_channel(self, 
                              ctx : commands.Context,
                              channel : discord.TextChannel) -&gt; discord.Message:
    ...
</code></pre>
<details>
<summary>Solution</summary>
<pre><code class="language-python">import discord
from discord.ext import commands

class Welcome(commands.Cog):
    def __init__(self, bot : commands.Bot):
        self.bot = bot
        self.welcome_channel = None

    @commands.Cog.listener()
    async def on_member_join(self, member : discord.Member) -&gt; None:
        if self.welcome_channel is not None:
            await self.welcome_channel.send(f&quot;Welcome {member.mention}!&quot;)

    @commands.command()
    async def set_welcome_channel(self, 
                                  ctx : commands.Context, 
                                  channel : discord.TextChannel) -&gt; discord.Message:
        self.welcome_channel = channel
        return await ctx.send(f&quot;Welcome channel set to {channel.mention}&quot;)

</code></pre>
</details>
<h3 id="exercice-3"><a class="header" href="#exercice-3">Exercice 3</a></h3>
<p>Maintenant que l'on dit bienvenue aux nouveaux membres, on va leur donner un rôle. Créer un Cog <code>Role</code> qui contient dans son constructeur un attribut <code>role</code> qui est initialisé à <code>None</code>. Ce Cog doit avoir un évènement <code>on_member_join</code> qui donne le rôle <code>role</code> au nouveau membre si celui-ci est défini. Le Cog doit aussi avoir une commande <code>set_role</code> qui permet de définir le rôle à donner.</p>
<p>L'évènement et la commande auront donc la structure suivante :</p>
<pre><code class="language-python">@commands.Cog.listener()
async def on_member_join(self, member : discord.Member) -&gt; None:
    ...
</code></pre>
<pre><code class="language-python">@commands.command()
async def set_role(self, 
                   ctx : commands.Context, 
                   role : discord.Role) -&gt; discord.Message:
    ...
</code></pre>
<details>
<summary>Solution</summary>
<pre><code class="language-python">import discord
from discord.ext import commands

class Role(commands.Cog):
    def __init__(self, bot : commands.Bot):
        self.bot = bot
        self.role = None

    @commands.Cog.listener()
    async def on_member_join(self, member : discord.Member) -&gt; None:
        if self.role is not None:
            await member.add_roles(self.role)

    @commands.command()
    async def set_role(self, 
                       ctx : commands.Context, 
                       role : discord.Role) -&gt; discord.Message:
        self.role = role
        return await ctx.send(f&quot;Role set to {role.mention}&quot;)

</code></pre>
</details>
<h3 id="exercice-4"><a class="header" href="#exercice-4">Exercice 4</a></h3>
<p>Notre nouveau membre vient de partir, on va donc lui envoyer un message de départ. Créer un Cog <code>Goodbye</code> qui contient dans son constructeur un attribut <code>goodbye_channel</code> qui est initialisé à <code>None</code>. Ce Cog doit avoir un évènement <code>on_member_remove</code> qui envoie un message de départ dans le salon <code>goodbye_channel</code> si celui-ci est défini. Le Cog doit aussi avoir une commande <code>set_goodbye_channel</code> qui permet de définir le salon de départ.</p>
<p>L'évènement et la commande auront donc la structure suivante :</p>
<pre><code class="language-python">@commands.Cog.listener()
async def on_member_remove(self, member : discord.Member) -&gt; None:
    ...
</code></pre>
<pre><code class="language-python">@commands.command()
async def set_goodbye_channel(self, 
                              ctx : commands.Context, 
                              channel : discord.TextChannel) -&gt; discord.Message:
    ...
</code></pre>
<details>
<summary>Solution</summary>
<pre><code class="language-python">import discord
from discord.ext import commands

class Goodbye(commands.Cog):
    def __init__(self, bot : commands.Bot):
        self.bot = bot
        self.goodbye_channel = None

    @commands.Cog.listener()
    async def on_member_remove(self, member : discord.Member) -&gt; None:
        if self.goodbye_channel is not None:
            await self.goodbye_channel.send(f&quot;Goodbye {member.mention}!&quot;)

    @commands.command()
    async def set_goodbye_channel(self, 
                                  ctx : commands.Context, 
                                  channel : discord.TextChannel) -&gt; discord.Message:
        self.goodbye_channel = channel
        return await ctx.send(f&quot;Goodbye channel set to {channel.mention}&quot;)

</code></pre>
</details>
<br>
<hr />

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../chapter_4/add_commands_to_a_cog.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../chapter_5/embeds.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../chapter_4/add_commands_to_a_cog.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../chapter_5/embeds.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
